Use Cloudflare Pages Git integration to host site on Cloudflare Pages.

Free tier seems OK. 
https://pages.cloudflare.com/#pricing
For my purposes, the limiting factor is a maximum of 500 re-deploys each month. I will never come close to that mark.

# Ensure required files exist



## Add requirements.txt file

Cloudflare pages requires a *requirements.txt* file exist in the project directory. It uses this file to build your static web site when you push code changes to your GitHub repository.

Create the file. First ensure your virtual environment is activated:

```bash
$ source env/bin/activate
(env) $
```

Then run the `pip freeze` command

```bash
(env) $ pip freeze > requirements.txt 
```

If you add more Pelican plugins or other Python packages that support your blog, you must run the freeze command again to rebuild the requirements.txt file.

## Copy the theme folder

There are multiple places you can store your Pelican theme files. Most Pelican tutorials recommend you store your theme fioles outside your project directory. However, Cloudflare Pages needs access to your theme files so, since you are interfacing with Cloudflare pages via a GitHub integration, the theme files must be in your Git repository.

That means the theme file should be in the project directory. You will have to manually copy the theme to a folder to your project directory and update the *pelicanconf.py* file to point to the folder.

For example, I use the [Flex theme](https://github.com/alexandrevicenzi/Flex#flex). But, I previously had installed it using the *pelican-themes* tool so the files are all in my Python environment folder. To keep using the Flex theme when this blog is published to the Cloudflare Pages, I copied the theme files from my environment directory to my project directory. 

first, I listed the thems I have installed in verbose mode so I can see the directories in which they are stored.

```bash
(env) $ pelican-themes -lv
/home/brian/Projects/learning-with-code/env/lib/python3.10/site-packages/pelican/themes/notmyidea
/home/brian/Projects/learning-with-code/env/lib/python3.10/site-packages/pelican/themes/simple
/home/brian/Projects/learning-with-code/env/lib/python3.10/site-packages/pelican/themes/Flex-2.5.0
```

Then, I created a new directory in my project called *themes* and copied the Flex-2.5.0 directory into it:

```bash
(env) $ mkdir themes
(env) $ cp /home/brian/Projects/learning-with-code/env/lib/python3.10/site-packages/pelican/themes/Flex-2.5.0 themes/
(env) $ ls -1
content
env
output
pelicanconf.py
publishconf.py
requirements.txt
themes
```

Then, I changed the `THEME` variable in the *pelicanconf.py* file to point to the relative path of the Flex theme directory:

```python
THEME = ./themes/Flex-2.5.0
```

I saved the *pelicanconf.py* file.

## Deactivate the Python environment

Optionally, you may then deactivate the virtual environment.

```bash
(env) $ deactivate
$
```

I just wanted to make it clear that, from this point on, we are not using Python.


# GitHub

I assume you have Git installed on your computer. If not, detailed installation instructions are on the Git web site at [git-scm.com](https://git-scm.com/book/en/v2/Getting-Started-Installing-Git).

## local Git repo

Pelican web site is in a directory. My directory is named *learning-with-code*.

```bash
$ cd learning-with-code
$ ls -1
content
env
output
pelicanconf.py
publishconf.py
requirements.txt
themes
```

Note that the Python virtual environment used to build the web site is in the project directory, in a subdirectory named *env*. That's the way I like to manage my Python virtual environments. You may organize your virtual environments differently.

Create a [new git repository](https://git-scm.com/book/en/v2/Getting-Started-First-Time-Git-Setup) in the directory. First, configure the name of the main branch and user information:

```bash
$ git config --global user.name "Brian Linkletter"
$ git config --global user.email fake@example.com
$ git config --global init.defaultBranch main
```

Add a [*.gitignore* file](https://git-scm.com/docs/gitignore) so you do not track the Python environment files and other Python infrastructure with the web site source code.

Get the Python Gitignore file from [GitHub's gitignore repository](https://github.com/github/gitignore). It comes with the *env/* directory already configured to ignore.

```bash
$ wget https://raw.githubusercontent.com/github/gitignore/main/Python.gitignore
$ mv Python.gitignore .gitignore
```

Then, add the *output* directory to the *.gitignore* file. You do not need to track the files generated by Pelican in your Git repository. You only need to track your source code.

Add the following lines to the end of the *.gitignore* file:

```bash
# Pelican framework files
output/
```

Save the file.

Initialize the Git repository 

```
$ git init
```

Add the existing web site files into the repository as your first commit

```bash
$ git add -A
$ git commit -m "testing first static web site"
```

Now you have a git repository that tracks all the source files that pelican uses to build your web site.

## Make remote on GitHub

Cloudflare Pages integrates with the GitHub platform. You need to create a remote repository on GitHub and sync your local Git repository with it.

I assume you have a GitHub account. If not, follow the instructions on the GitHub web site to [create your own GitHub account](https://docs.github.com/en/get-started/signing-up-for-github/signing-up-for-a-new-github-account).

I also assume you have provided your SSH public key to GitHub. If not, follow the instructions on *github.com* to [create and configure SSH authentication](https://docs.github.com/en/authentication/connecting-to-github-with-ssh/adding-a-new-ssh-key-to-your-github-account).


Log into your GitHub account and [create a new repository](https://docs.github.com/en/get-started/quickstart/create-a-repo). In this example, I named the repository *learning-with-code*, the same name as my local project directory.

![](/home/brian/Pictures/web-site-temp/010-github-repo-001.png)

I chose not to create a *.gitignore* file because I already have one in my local repository. Click on the *Create repository* button.

Now sync your local Git repository with the remote GitHub repository:

```bash
$ git remote add origin git@github.com:blinklet/learning-with-code.git
$ git branch -M main
$ git push -u origin main
```

# Cloudflare

## Cloudflare Pages account setup

Go to [https://pages.cloudflare.com/](https://pages.cloudflare.com/)

Click on *Sign Up*

Provide e-mail address and choose a password.

Click on *Sign up*

Your account will be verified via e-mail

https://developers.cloudflare.com/pages/framework-guides/deploy-anything/

## Cloudflare GitHub integration 

Cloudflare offers good documentation that describes [how to deploy a Pelican site](https://developers.cloudflare.com/pages/framework-guides/deploy-a-pelican-site/). Below, I list a summary of the steps for your convenience:

In the Cloudflare dashboard, click on *Pages* then click on *Connect to Git*
Choose *GitHub* and then click on *Connect GitHub*

Select *Only select repositories* and then choose your web site's repo. In my case, I chose "learning-with-code". Click on *Install & Authorize*

Back at the dashboard, click on the repository again so the *Begin setup* button lights up. The click on *Begin setup*

## Pages settings

In the next page, verify the web site name and make a note of the URL the web page will have. In this example, I set the project name to the name I want my website to have: "Learning-with-code". So, the URL will be *learning-with-code.pages.dev*.

Choose "Pelican" from the *Frameworks* menu. This automatically populated the *Build command* and *Build output directory* fields with default values. The build command is "pelican content" and the build output directory is "output".

## Set *PYTHON_VERSION* environment variable

On the same Settings page, add an environment variable that defines the version of Python that Cloudflare Pages will use. Cloudflare requires you set the  *PYTHON_VERSION* environment variable to *3.7*. Click the *Save* button to set the variable.

I was surprised they only support a version of Python that is so old but I tried new versions and they did not work.

## Deploy

Finally, click *Save and Deploy* at the bottom of the page to complete the setup.

From this point on, Cloudflare will watch your GitHub repository and will re-build and re-deploy the web site every time you push any changes up to the Github repository.



# Conclusion

Now, my web site is set up and ready to serve.

Next I will set up a custom domain so I can use a domain name of my choice, instead of the domain *pages.dev*.

